<!doctype html>
<html lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="search" type="application/opensearchdescription+xml" title="Guide" href="/zh-CN/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli&display=swap">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js" onload="addBackToTop()" defer="defer"></script>
<script src="https://apisa.web3.foundation/latest.js" async defer="defer"></script>
<script src="/js/custom.js"></script>
<script src="/js/clipboard.min.js"></script>
<script src="/js/copycode.js"></script><title data-react-helmet="true">Cross-chain Message Passing (XCMP) · Guide</title><meta data-react-helmet="true" property="og:url" content="https://guide.kusama.network/zh-CN/docs/learn-crosschain"><meta data-react-helmet="true" name="docsearch:language" content="zh-CN"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Cross-chain Message Passing (XCMP) · Guide"><meta data-react-helmet="true" name="description" content="Cross-chain transactions are resolved using a simple queuing mechanism based around a Merkle tree to"><meta data-react-helmet="true" property="og:description" content="Cross-chain transactions are resolved using a simple queuing mechanism based around a Merkle tree to"><link data-react-helmet="true" rel="shortcut icon" href="/zh-CN/img/Kusama_Canary_white.png"><link data-react-helmet="true" rel="canonical" href="https://guide.kusama.network/zh-CN/docs/learn-crosschain"><link data-react-helmet="true" rel="alternate" href="https://guide.kusama.network/docs/learn-crosschain" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://guide.kusama.network/zh-CN/docs/learn-crosschain" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://guide.kusama.network/docs/learn-crosschain" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh-CN/assets/css/styles.e70a5d2b.css">
<link rel="preload" href="/zh-CN/assets/js/runtime~main.13a04fce.js" as="script">
<link rel="preload" href="/zh-CN/assets/js/main.ba81d42f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">跳到主要内容</a></div><div class="announcementBar_3WsW" style="background-color:#e6007a" role="banner"><div class="announcementBarContent_3EUC"><a id="support_us" href="/docs/contributing" title="Contribute to this wiki" data-ribbon="Contribute to this wiki">
          Contribute to this wiki
        </a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><img src="/zh-CN/img/Kusama_logotype_white_large.png" alt="Guide" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh-CN/img/Kusama_logotype_white_large.png" alt="Guide" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Guide</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh-CN/docs/kusama-getting-started">Get Started</a><a class="navbar__item navbar__link" href="/zh-CN/docs/kusama-index">Docs</a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文</span></span></a><ul class="dropdown__menu"><li><a href="/docs/learn-crosschain" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh-CN/docs/learn-crosschain" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文</a></li><li><a href="https://crowdin.com/project/polkadot-wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help us translate</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Cross-chain Message Passing (XCMP)</h1></header><p>Cross-chain transactions are resolved using a simple queuing mechanism based around a Merkle tree to
ensure fidelity. It is the task of the Relay Chain validators to move transactions on the output
queue of one parachain into the input queue of the destination parachain. However, only the
associated metadata is stored as a hash in the Relay Chain storage.</p><p>The input and output queue are sometimes referred to in the codebase and associated documentation as
<code>ingress</code> and <code>egress</code> messages respectively.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="overview-of-xcmp"></a>Overview of XCMP<a class="hash-link" href="#overview-of-xcmp" title="标题的直接链接">#</a></h2><p>XCMP is currently under development and the details are subject to change. However, the overall
architecture and design decisions are as follows:</p><ul><li>Cross-chain messages will <em>not</em> go on to the Relay Chain.</li><li>Cross-chain messages will be constrained to a maximum size in bytes.</li><li>Parachains are allowed to block messages from other parachains, in which case the dispatching
parachain would be aware of this block.</li><li>Collator nodes are responsible for routing messages between chains.</li><li>Collators produce a list of &quot;egress&quot; messages and will receive the &quot;ingress&quot; messages from other
parachains.</li><li>On each block, parachains are expected to route messages from some subset of all other parachains.</li><li>When a collator produces a new block to hand off to a validator, it will collect the latest
ingress queue information and process it.</li><li>Validators will check a proof that the new candidate for the next parachain block includes the
processing of the expected ingress messages to that parachain.</li></ul><p>XCMP queues must be initiated by first opening a channel between two parachains. The channel is
identified by both the sender and recipient parachains, meaning that it&#x27;s a one-way channel. A pair
of parachains can have at most two channels between them, one for sending messages to the other
chain and another for receiving messages. The channel will require a deposit in DOT to be opened,
which will get returned when the channel is closed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="xcmp-lite-hrmp"></a>XCMP-Lite (HRMP)<a class="hash-link" href="#xcmp-lite-hrmp" title="标题的直接链接">#</a></h2><p>While XCMP is still being implemented, a stop-gap protocol (see definition below) known as
<strong>Horizontal Relay-routed Message Passing (HRMP)</strong> exists in its place. HRMP has the same interface
and functionality as XCMP but is much more demanding on resources since it stores all messages in
the Relay Chain storage. When XCMP has been implemented, HRMP is planned to be deprecated and phased
out in favor of it.</p><blockquote><p>Note: A stop-gap protocol is a temporary substitute for the functionality that is not fully
complete. While XCMP proper is still in development, HRMP is a working replacement.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="vertical-message-passing"></a>Vertical Message Passing<a class="hash-link" href="#vertical-message-passing" title="标题的直接链接">#</a></h2><p>There are two kinds of Vertical Message Passing, Upward Message Passing (UMP) and Downward Message
Passing (DMP). UMP is used when a message originates on a parachain or a parathread to go from that
parachain up to the Relay Chain. DMP is used to go the other way around, when a message originates
from the Relay Chain and is destined for a parachain. Messages that are passed via DMP may originate
from a parachain. In which case, first UMP is used to communicate the message to the Relay Chain and
DMP is used to move it down to another parachain.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="xcmp-message-format"></a>XCMP Message Format<a class="hash-link" href="#xcmp-message-format" title="标题的直接链接">#</a></h2><p>For a description of the XCMP message format please see the <a href="https://github.com/paritytech/xcm-format" target="_blank" rel="noopener noreferrer">xcm-format</a> repository on GitHub.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-to-make-cross-chain-transfers"></a>How To Make Cross Chain Transfers<a class="hash-link" href="#how-to-make-cross-chain-transfers" title="标题的直接链接">#</a></h2><p>You can try out cross-chain transfers on the the <a href="/zh-CN/docs/build-parachains-rococo">Rococo</a> testnet. A
tutorial on downward, upward, and lateral transfers can be found
<a href="/zh-CN/docs/build-parachains-rococo#how-to-make-cross-chain-transfers">here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="high-level-xcmp"></a>High-Level XCMP<a class="hash-link" href="#high-level-xcmp" title="标题的直接链接">#</a></h2><p>A smart contract that exists on parachain A will route a message to parachain B in which another
smart contract is called that makes a transfer of some assets within that chain.</p><p>Charlie executes the smart contract on parachain A, which initiates a new cross-chain message for
the destination of a smart contract on parachain B.</p><p>The collator node of parachain A will place this new cross-chain message into its outbound messages
queue, along with a <code>destination</code> and a <code>timestamp</code>.</p><p>The collator node of parachain B routinely pings all other collator nodes asking for new messages
(filtering by the <code>destination</code> field). When the collator of parachain B makes its next ping, it
will see this new message on parachain A and add it into its own inbound queue for processing into
the next block.</p><p>Validators for parachain A will also read the outbound queue and know the message. Validators for
parachain B will do the same. This is so that they will be able to verify the message transmission
happened.</p><p>When the collator of parachain B is building the next block in its chain, it will process the new
message in its inbound queue as well as any other messages it may have found/received.</p><p>During processing, the message will execute the smart contract on parachain B and complete the asset
transfer like intended.</p><p>The collator now hands this block to the validator, which itself will verify that this message was
processed. If the message was processed and all other aspects of the block are valid, the validator
will include this block for parachain B into the Relay Chain.</p><p>Check out our animated video below that explores how XCMP works.</p><video controls="" name="XCMP Animated Video" width="560" height="315" src="https://storage.googleapis.com/w3f-tech-ed-contents/XCMP.mp4"> Sorry, your browser doesn&#x27;t support embedded videos. </video><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="resources"></a>Resources<a class="hash-link" href="#resources" title="标题的直接链接">#</a></h2><ul><li><a href="https://research.web3.foundation/en/latest/polkadot/XCMP.html" target="_blank" rel="noopener noreferrer">XCMP Scheme</a> - Full technical
description of cross-chain communication on the Web3 Foundation research wiki.</li><li><a href="https://w3f.github.io/parachain-implementers-guide/messaging.html" target="_blank" rel="noopener noreferrer">Messaging Overview</a> - An
overview of the messaging schemes from the Parachain Implementor&#x27;s guide.</li><li><a href="https://github.com/paritytech/xcm-format" target="_blank" rel="noopener noreferrer">XCM Format</a> - Description of the high-level XCM format
sent via XCMP.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/w3f/polkadot-wiki/edit/master/docs/learn-crosschain.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_3DPF">最后由 <b>alex</b> 于 <b><time datetime="2021-08-13T15:05:14.000Z">2021/8/13</time></b> 更新</div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview-of-xcmp" class="table-of-contents__link">Overview of XCMP</a></li><li><a href="#xcmp-lite-hrmp" class="table-of-contents__link">XCMP-Lite (HRMP)</a></li><li><a href="#vertical-message-passing" class="table-of-contents__link">Vertical Message Passing</a></li><li><a href="#xcmp-message-format" class="table-of-contents__link">XCMP Message Format</a></li><li><a href="#how-to-make-cross-chain-transfers" class="table-of-contents__link">How To Make Cross Chain Transfers</a></li><li><a href="#high-level-xcmp" class="table-of-contents__link">High-Level XCMP</a></li><li><a href="#resources" class="table-of-contents__link">Resources</a></li></ul></div></div></div></div></main></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/zh-CN/" class="nav-home"><img src="/zh-CN/img/Kusama_Canary_white.png" alt="Guide" width="66" height="58"></a><div><p class="homepage-font">Kusama is an experimental <br>community research and<br> development network.</p><a href="/zh-CN/docs/kusama-index" target="_blank" class="homepage-font">Docs</a><a href="https://kusama.network/" target="_blank" class="homepage-font">Kusama Network</a><a href="https://twitter.com/kusamanetwork" target="_blank" rel="noreferrer noopener" class="homepage-font">Twitter</a><a href="https://matrix.to/#/!HfRYKXBoPmDBCAWUEJ:polkadot.builders" target="_blank" rel="noreferrer noopener" class="homepage-font">Kusama Watercooler (Element Chat)</a></div><a href="/kusama-wiki.zip" target="_blank" rel="noreferrer noopener">Download this Guide as PDF</a></section><section class="row"><div class="copyright homepage-font">© 2021 Web3 Foundation</div><a class="item homepage-font" href="https://polkadot.network/privacy/">Privacy Policy</a></section></footer></div>
<script src="/zh-CN/assets/js/runtime~main.13a04fce.js"></script>
<script src="/zh-CN/assets/js/main.ba81d42f.js"></script>
</body>
</html>