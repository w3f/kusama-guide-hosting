<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-maintain/maintain-guides-async-backing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Upgrade Parachain for Asynchronous Backing Compatibility · Guide</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://guide.kusama.network/docs/maintain-guides-async-backing"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Upgrade Parachain for Asynchronous Backing Compatibility · Guide"><meta data-rh="true" name="description" content="Steps on how to upgrade a parachain to be compatible with the relay chain&#x27;s async backing feature."><meta data-rh="true" property="og:description" content="Steps on how to upgrade a parachain to be compatible with the relay chain&#x27;s async backing feature."><meta data-rh="true" name="keywords" content="async,backing,parachain,consensus"><link data-rh="true" rel="icon" href="/img/Kusama_Canary_white.png"><link data-rh="true" rel="canonical" href="https://guide.kusama.network/docs/maintain-guides-async-backing"><link data-rh="true" rel="alternate" href="https://guide.kusama.network/docs/maintain-guides-async-backing" hreflang="en"><link data-rh="true" rel="alternate" href="https://guide.kusama.network/docs/maintain-guides-async-backing" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://33KMAMG2DG-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Guide" href="/opensearch.xml">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli&display=swap">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js" onload="addBackToTop()" defer="defer"></script>
<script src="https://apisa.kusama.network/latest.js" async defer="defer"></script>
<script src="../js/custom.js"></script>
<script src="../js/clipboard.min.js"></script>
<script src="../js/copycode.js"></script><link rel="stylesheet" href="/assets/css/styles.dd7fb8ad.css">
<link rel="preload" href="/assets/js/runtime~main.161af186.js" as="script">
<link rel="preload" href="/assets/js/main.d3bff339.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#e6007a;color:white" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">The Polkadot Blockchain Academy is coming to Asia! <a href="https://www.polkadot.network/development/academy/?utm_source=guide.kusama.network&utm_medium=referral&utm_campaign=pba%204%205&utm_content=notification" target="_blank" rel="noopener noreferrer">Find out more 👉</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Kusama_logotype_white_large.png" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/Kusama_logotype_white_large.png" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Guide</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/kusama-getting-started">Docs</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a class="navbar__item navbar__link" href="/docs/contributing">Contribute</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/maintain-guides-async-backing" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="https://crowdin.com/project/polkadot-wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help us translate</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Upgrade Parachain for Asynchronous Backing Compatibility</h1></header><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Who is this guide for?</div><div class="admonitionContent_S0QG"><p>This guide is relevant for cumulus based parachain projects started in 2023 or before. Later
projects should already be async backing compatible. If starting a new parachain project, please use
an async backing compatible template such as
<a href="https://github.com/paritytech/cumulus/tree/rh-test-async-backing" target="_blank" rel="noopener noreferrer"><code>cumulus/parachain-template</code></a>.</p></div></div><p>The rollout process for Async Backing has three phases. Phases 1 and 2 below put new infrastructure
in place. Then we can simply turn on async backing in phase 3. But first, some pre-reqs and context
to set the stage.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="async-backing-prerequisites">Async Backing Prerequisites<a href="#async-backing-prerequisites" class="hash-link" aria-label="Direct link to Async Backing Prerequisites" title="Direct link to Async Backing Prerequisites">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>For more contextual information about asynchronous backing, see
<a href="/docs/learn-async-backing">this page</a>.</p></div></div><p>Pull the latest version of Cumulus for use with your parachain. It contains necessary changes for
async backing compatibility. Latest on master branch of
<a href="https://github.com/paritytech/polkadot-sdk" target="_blank" rel="noopener noreferrer">Polkadot-SDK</a> is currently sufficient. Any 2024 release
will work as well.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="async-backing-terminology-and-parameters">Async Backing Terminology and Parameters<a href="#async-backing-terminology-and-parameters" class="hash-link" aria-label="Direct link to Async Backing Terminology and Parameters" title="Direct link to Async Backing Terminology and Parameters">​</a></h2><p>Time for a bit of context before we get started. The following concepts will aid in demystifying the
collator side of Async Backing and establish a basic understanding of the changes being made:</p><ul><li><strong>Unincluded segment</strong> - From the perspective of a parachain block under construction, the
unincluded segment describes a chain of recent block ancestors which have yet to be included on
the relay chain. The ability to build new blocks on top of the unincluded segment rather than on
top of blocks freshly included in the relay chain is the core of asynchronous backing.</li><li><strong>Capacity</strong> - The maximum size of the unincluded segment. The longer this is, the farther ahead a
parachain can work, producing new candidates before the ancestors of those candidates have been
seen as included on-chain. Practically, a capacity of 2-3 is sufficient to realize the full
benefits of asynchronous backing, at least until the release of elastic scaling.</li><li><strong>Velocity</strong> - The base rate at which a parachain should produce blocks. A velocity of 1 indicates
that 1 parachain block should be produced per relay chain block. In order to fill the unincluded
segment with candidates, collators may build up to <code>Velocity + 1</code> candidates per aura slot while
there is remaining capacity. When elastic scaling has been released velocities greater than 1 will
be supported.</li><li><strong>AllowMultipleBlocksPerSlot</strong> - If this is <code>true</code>, Aura will allow slots to stay the same across
sequential parablocks. Otherwise the slot number must increase with each block. To fill the
unincluded segment as described above we need this to be <code>true</code>.</li><li><strong>FixedVelocityConsensusHook</strong> - This is a variety of <code>ConsensusHook</code> intended to be passed to
<code>parachain-system</code> as part of its <code>Config</code>. It is triggered on initialization of a new runtime. An
instance of <code>FixedVelocityConsensusHook</code> is defined with both a fixed capacity and velocity. It
aborts the runtime early if either capacity or velocity is exceeded, as the collator shouldn’t be
creating additional blocks in that case.</li><li><strong>AsyncBackingParams.max_candidate_depth</strong> - This parameter determines the maximum unincluded
segment depth the relay chain will support. Candidates sent to validators which exceed
<code>max_candidate_depth</code> will be ignored. <code>Capacity</code>, as mentioned above, should not exceed
<code>max_candidate_depth</code>.</li><li><strong>AsyncBackingParams.allowed_ancestry_len</strong> - Each parachain block candidate has a <code>relay_parent</code>
from which its execution and validation context is derived. Before async backing the
<code>relay_parent</code> for a candidate not yet backed was required to be the fresh head of a fork. With
async backing we can relax this requirement. Instead we set a conservative maximum age in blocks
for the <code>relay_parent</code>s of candidates in the unincluded segment. This age, <code>allowed_ancestry_len</code>
lives on the relay chain and is queried by parachains when deciding which block to build on top
of.</li><li><strong>Lookahead Collator</strong> - A collator for Aura that looks ahead of the most recently included
parachain block when determining what to build upon. This collator also builds additional blocks
when the maximum backlog is not saturated. The size of the backlog is determined by invoking the
AuraUnincludedSegmentApi. If that runtime API is not supported, this assumes a maximum backlog
size of 1.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-1---update-parachain-runtime">Phase 1 - Update Parachain Runtime<a href="#phase-1---update-parachain-runtime" class="hash-link" aria-label="Direct link to Phase 1 - Update Parachain Runtime" title="Direct link to Phase 1 - Update Parachain Runtime">​</a></h2><p>This phase involves configuring your parachain’s runtime to make use of async backing system.</p><ol><li><p>Establish constants for <code>capacity</code> and <code>velocity</code> and set both of them to 1 in
<code>/runtime/src/lib.rs</code>.</p></li><li><p>Establish a constant relay chain slot duration measured in milliseconds equal to <code>6000</code> in
<code>/runtime/src/lib.rs</code>.</p></li></ol><p><img loading="lazy" alt="capacity-velocity" src="/assets/images/async-backing-capacity-velocity-284086ee80ed6f362605da2861982fd4.png" width="3024" height="732" class="img_ev3q"></p><ol start="3"><li>Establish constants <code>MILLISECS_PER_BLOCK</code> and <code>SLOT_DURATION</code> if not already present in
<code>/runtime/src/lib.rs</code>.</li></ol><p><img loading="lazy" alt="capacity-velocity" src="/assets/images/async-backing-slot-duration-8ae26819c2ecff7ebde87441782c315c.png" width="2744" height="712" class="img_ev3q"></p><ol start="4"><li><p>Configure <code>cumulus_pallet_parachain_system</code> in <code>runtime/src/lib.rs</code></p><ul><li>Define a <code>FixedVelocityConsensusHook</code> using our capacity, velocity, and relay slot duration
constants. Use this to set the parachain system <code>ConsensusHook</code> property.</li></ul><p><img loading="lazy" alt="consensus-hook" src="/assets/images/async-backing-consensus-hook-d0b32b28cfd96c484bdbd33d3021469d.png" width="2818" height="1704" class="img_ev3q"></p><ul><li>Set the parachain system property <code>CheckAssociatedRelayNumber</code> to
<code>RelayNumberMonotonicallyIncreases</code></li></ul><p><img loading="lazy" alt="Associated-Relay-number" src="/assets/images/async-backing-associated-relay-57246a3cb56d0030314ca79fef4b9ce0.png" width="3194" height="900" class="img_ev3q"></p></li><li><p>Configure <code>pallet_aura</code> in <code>runtime/src/lib.rs</code></p><ul><li>Set <code>AllowMultipleBlocksPerSlot</code> to false</li><li>Define <code>pallet_aura::SlotDuration</code> using our constant <code>SLOT_DURATION</code></li></ul><p><img loading="lazy" alt="Aura-config" src="/assets/images/async-backing-config-aura-78aaaceb60b158603d2536d22987de34.png" width="1964" height="704" class="img_ev3q"></p></li><li><p>Update <code>aura_api::SlotDuration()</code> to match the constant <code>SLOT_DURATION</code></p><p><img loading="lazy" alt="Aura-spi" src="/assets/images/async-backing-aura-api-32badf8707637f9b9b344d42c7056132.png" width="2372" height="380" class="img_ev3q"></p></li><li><p>Implement the AuraUnincludedSegmentApi, which allows the collator client to query its runtime to
determine whether it should author a block.</p><ul><li><p>Add the dependency <code>cumulus-primitives-aura</code> to the <code>runtime/Cargo.toml</code> file for your runtime</p><p><img loading="lazy" alt="cargo-toml" src="/assets/images/async-backing-cargo-7a4e51836905ddfd6166d0c6585c8547.png" width="3200" height="602" class="img_ev3q"></p></li><li><p>Inside the <code>impl_runtime_apis!</code> block for your runtime, implement the
<code>AuraUnincludedSegmentApi</code> as shown below.</p><p><img loading="lazy" alt="unincluded-segment" src="/assets/images/async-backing-unincluded-segment-a7371567ff6508ab3a59ed1b54bb28f0.png" width="2686" height="700" class="img_ev3q"></p><p>Important note: With a capacity of 1 we have an effective velocity of ½ even when velocity is
configured to some larger value. This is because capacity will be filled after a single block
is produced and will only be freed up after that block is included on the relay chain, which
takes 2 relay blocks to accomplish. Thus with capacity 1 and velocity 1 we get the customary 12
second parachain block time.</p></li></ul></li><li><p>If your <code>runtime/src/lib.rs</code> provides a <code>CheckInherents</code> type to <code>register_validate_block</code>,
remove it. <code>FixedVelocityConsensusHook</code> makes it unnecessary. The following example shows how
<code>register_validate_block</code> should look after removing <code>CheckInherents</code>.</p><p><img loading="lazy" alt="register-validate-block" src="/assets/images/async-backing-register-validate-d2b309bef0cf424dc03ec58bbe4b329c.png" width="2852" height="354" class="img_ev3q"></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-2---update-parachain-nodes">Phase 2 - Update Parachain Nodes<a href="#phase-2---update-parachain-nodes" class="hash-link" aria-label="Direct link to Phase 2 - Update Parachain Nodes" title="Direct link to Phase 2 - Update Parachain Nodes">​</a></h2><p>This phase consists of plugging in the new lookahead collator node.</p><ol><li>Import <code>cumulus_primitives_core::ValidationCode</code> to <code>node/src/service.rs</code></li></ol><p><img loading="lazy" alt="import-validation-code" src="/assets/images/async-backing-cumulus-primitives-1f9fdc12cf1dff0f1d180857797034ef.png" width="1676" height="312" class="img_ev3q"></p><ol start="2"><li>In <code>node/src/service.rs</code>, modify <code>sc_service::spawn_tasks</code> to use a clone of <code>Backend</code> rather
than the original</li></ol><p><img loading="lazy" alt="spawn-tasks" src="/assets/images/async-backing-spawn-tasks-e5041596b06c8c23c0e3b33f5cd0556d.png" width="2182" height="1224" class="img_ev3q"></p><ol start="3"><li>Add <code>backend</code> as a parameter to <code>start_consensus()</code> in <code>node/src/service.rs</code></li></ol><p><img loading="lazy" alt="start-consensus-1" src="/assets/images/async-backing-start-consensus-623d270ec4a847084f8b9f7c338ad347.png" width="3040" height="616" class="img_ev3q"></p><p><img loading="lazy" alt="start-consensus-2" src="/assets/images/async-backing-start-consensus-2-6a192785fc1b07d8ca69653c4a630824.png" width="2890" height="614" class="img_ev3q"></p><ol start="4"><li>In <code>start_consensus()</code> import the lookahead collator rather than the basic collator</li></ol><p><img loading="lazy" alt="lookahead-collator" src="/assets/images/async-backing-lookahead-collator-c0ddf4595a07a3519a9f3ce39291b85b.png" width="3192" height="98" class="img_ev3q"></p><ol start="5"><li>In <code>start_consensus()</code> replace the <code>BasicAuraParams</code> struct with <code>AuraParams</code><ul><li>Change the struct type from <code>BasicAuraParams</code> to <code>AuraParams</code></li><li>In the <code>para_client</code> field, pass in a cloned para client rather than the original</li><li>Add a <code>para_backend</code> parameter after <code>para_client</code>, passing in our para backend</li><li>Provide a <code>code_hash_provider</code> closure like that shown below</li><li>Increase <code>authoring_duration</code> from 500 milliseconds to 1500</li></ul></li></ol><p>Note: Set <code>authoring_duration</code> to whatever you want, taking your own hardware into account. But if
the backer who should be slower than you due to reading from disk, times out at two seconds your
candidates will be rejected.</p><p><img loading="lazy" alt="Aura-params" src="/assets/images/async-backing-aura-params-b3ddee0fd3fdb97a624bbfe6aba4a1c2.png" width="3196" height="1726" class="img_ev3q"></p><ol start="6"><li>In <code>start_consensus()</code> replace <code>basic_aura::run</code> with <code>aura::run</code></li></ol><p><img loading="lazy" alt="Aura-run" src="/assets/images/async-backing-aura-run-12845909492ef12ee7c65b411f2eb21c.png" width="3190" height="598" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-3---activate-async-backing">Phase 3 - Activate Async Backing<a href="#phase-3---activate-async-backing" class="hash-link" aria-label="Direct link to Phase 3 - Activate Async Backing" title="Direct link to Phase 3 - Activate Async Backing">​</a></h2><p>This phase consists of changes to your parachain’s runtime that activate async backing feature.</p><ol><li>Configure <code>pallet_aura</code>, setting <code>AllowMultipleBlocksPerSlot</code> to true in <code>runtime/src/lib.rs</code>.</li></ol><p><img loading="lazy" alt="Aura-allow-multiple-blocks" src="/assets/images/async-backing-allow-multiple-12827c5ae8be763b2b2ec5b16ba59ece.png" width="1920" height="678" class="img_ev3q"></p><ol start="2"><li>Increase the maximum unincluded segment capacity in <code>runtime/src/lib.rs</code>.</li></ol><p><img loading="lazy" alt="Unincluded-segment-capacity" src="/assets/images/async-backing-unincluded-segment-a7371567ff6508ab3a59ed1b54bb28f0.png" width="2686" height="700" class="img_ev3q"></p><ol start="3"><li>Either decrease <code>MILLISECS_PER_BLOCK</code> to 6000 or increase <code>BLOCK_PROCESSING_VELOCITY</code> to 2 in
<code>runtime/src/lib.rs</code>.</li></ol><ul><li>Note: For a parachain which measures time in terms of its own block number rather than by relay
block number it may be preferable to increase velocity. Changing block time may cause
complications, requiring additional changes. See the section “Timing by Block Number”.</li></ul><p><img loading="lazy" alt="block-time" src="/assets/images/async-backing-block-time-f377d59fc54bd7da4bc40ffda9a5bb42.png" width="2740" height="626" class="img_ev3q"></p><ol start="4"><li>Update <code>MAXIMUM_BLOCK_WEIGHT</code> to reflect the increased time available for block production.</li></ol><p><img loading="lazy" alt="block-weight" src="/assets/images/async-backing-maxblock-weight-4a93f8ba093eb551f53beca9ae26940e.png" width="2614" height="428" class="img_ev3q"></p><ol start="5"><li>Add a feature flagged alternative for <code>MinimumPeriod</code> in <code>pallet_timestamp</code>. The type should be
<code>ConstU64&lt;0&gt;</code> with the feature flag experimental, and <code>ConstU64&lt;{SLOT_DURATION / 2}&gt;</code> without.</li></ol><p><img loading="lazy" alt="minimum-period" src="/assets/images/async-backing-minimum-period-7ff2737538315419ff89dc7af0ce774a.png" width="2422" height="814" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="timing-by-block-number">Timing by Block Number<a href="#timing-by-block-number" class="hash-link" aria-label="Direct link to Timing by Block Number" title="Direct link to Timing by Block Number">​</a></h2><p>With asynchronous backing it will be possible for parachains to opt for a block time of 6 seconds
rather than 12 seconds. But modifying block duration isn’t so simple for a parachain which was
measuring time in terms of its own block number. It could result in expected and actual time not
matching up, stalling the parachain.</p><p>One strategy to deal with this issue is to instead rely on relay chain block numbers for timing.
Relay block number is kept track of by each parachain in <code>pallet-parachain-system</code> with the storage
value <code>LastRelayChainBlockNumber</code>. This value can be obtained and used wherever timing based on
block number is needed.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-11-03T11:13:06.000Z">Nov 3, 2023</time></b> by <b>Filippo</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#async-backing-prerequisites" class="table-of-contents__link toc-highlight">Async Backing Prerequisites</a></li><li><a href="#async-backing-terminology-and-parameters" class="table-of-contents__link toc-highlight">Async Backing Terminology and Parameters</a></li><li><a href="#phase-1---update-parachain-runtime" class="table-of-contents__link toc-highlight">Phase 1 - Update Parachain Runtime</a></li><li><a href="#phase-2---update-parachain-nodes" class="table-of-contents__link toc-highlight">Phase 2 - Update Parachain Nodes</a></li><li><a href="#phase-3---activate-async-backing" class="table-of-contents__link toc-highlight">Phase 3 - Activate Async Backing</a></li><li><a href="#timing-by-block-number" class="table-of-contents__link toc-highlight">Timing by Block Number</a></li></ul></div></div></div></div></main></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Kusama_Canary_white.png" alt="Guide" width="66" height="58"></a><div><a href="https://kusama.network/" target="_blank" class="homepage-font">Kusama Network</a><a href="https://polkadot.network/faq/" target="_blank" rel="noreferrer noopener" class="homepage-font">FAQ</a><a href="https://twitter.com/kusamanetwork" target="_blank" rel="noreferrer noopener" class="homepage-font">Twitter</a><a href="https://www.notion.so/web3foundation/Polkadot-Kusama-Community-Hub-ee1fd077ff6c42c381940404f6aa9f1c" target="_blank" rel="noreferrer noopener" class="homepage-font">Community Hub</a><a href="https://kusa.ma/discord" target="_blank" rel="noreferrer noopener" class="homepage-font">Kusama Discord</a><a href="https://matrix.to/#/!HfRYKXBoPmDBCAWUEJ:polkadot.builders" target="_blank" rel="noreferrer noopener" class="homepage-font">Kusama Watercooler</a><a href="https://web3.foundation/grants/" target="_blank" rel="noreferrer noopener" class="homepage-font">Grants and Bounties</a></div><div class="kusama-mainpage-cyber-row"><div class="kusama-mainpage-column"><h2 class="homepage-font-footer">Join a cyber secret society</h2><p class="homepage-font-footer">The Kappa Sigma Mu fraternity asks you to get a Kusama tattoo to join.</p><a href="/docs/maintain-guides-society-kusama"><button class="kusama-mainpage-build-footer">See Kappa Sigma Mu</button></a></div></div></section><section class="row"><div class="copyright homepage-font">© 2023 Web3 Foundation</div>·<a target="_blank" rel="noreferrer noopener" class="item homepage-font" href="https://polkadot.network/legal-disclosures/">Legal Disclosures</a>·<a target="_blank" rel="noreferrer noopener" class="item homepage-font" href="https://polkadot.network/privacy/">Privacy Policy</a></section></footer></div>
<script src="/assets/js/runtime~main.161af186.js"></script>
<script src="/assets/js/main.d3bff339.js"></script>
</body>
</html>