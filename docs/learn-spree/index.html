<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-learn/learn-spree" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">SPREE · Guide</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://guide.kusama.network/docs/learn-spree"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SPREE · Guide"><meta data-rh="true" name="description" content="Fundamentals of SPREE."><meta data-rh="true" property="og:description" content="Fundamentals of SPREE."><meta data-rh="true" name="keywords" content="execution,SPREE,wasm,runtime"><link data-rh="true" rel="icon" href="/img/Kusama_Canary_white.png"><link data-rh="true" rel="canonical" href="https://guide.kusama.network/docs/learn-spree"><link data-rh="true" rel="alternate" href="https://guide.kusama.network/docs/learn-spree" hreflang="en"><link data-rh="true" rel="alternate" href="https://guide.kusama.network/docs/learn-spree" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://33KMAMG2DG-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Guide" href="/opensearch.xml">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli&display=swap">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js" onload="addBackToTop()" defer="defer"></script>
<script src="https://apisa.kusama.network/latest.js" async defer="defer"></script>
<script src="../js/custom.js"></script>
<script src="../js/clipboard.min.js"></script>
<script src="../js/copycode.js"></script><link rel="stylesheet" href="/assets/css/styles.dd7fb8ad.css">
<link rel="preload" href="/assets/js/runtime~main.161af186.js" as="script">
<link rel="preload" href="/assets/js/main.d3bff339.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#e6007a;color:white" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">The Polkadot Blockchain Academy is coming to Asia! <a href="https://www.polkadot.network/development/academy/?utm_source=guide.kusama.network&utm_medium=referral&utm_campaign=pba%204%205&utm_content=notification" target="_blank" rel="noopener noreferrer">Find out more 👉</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Kusama_logotype_white_large.png" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/Kusama_logotype_white_large.png" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Guide</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/kusama-getting-started">Docs</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a class="navbar__item navbar__link" href="/docs/contributing">Contribute</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/learn-spree" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="https://crowdin.com/project/polkadot-wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help us translate</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>SPREE</h1></header><p>Shared Protected Runtime Execution Enclaves (SPREE) sometimes referred to as &quot;trust wormholes,&quot; are
fragments of logic comparable to runtime modules in Substrate, but live on the
Kusama Relay Chain and maybe opted into by
parachains.</p><p>SPREE in brief was described with the following properties and functions:</p><ul><li>Parachains can opt-in to special runtime logic fragments (like smart contracts).</li><li>These fragments have their own storage and own <a href="/docs/learn-xcm">XCM</a> endpoint.</li><li>All instances across parachains have identical logic.</li><li>It executes alongside parachain logic.</li><li>Protected: storage can not be altered by parachain logic; messages can not be faked from them by
parachains.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="origin">Origin<a href="#origin" class="hash-link" aria-label="Direct link to Origin" title="Direct link to Origin">​</a></h2><p>On 28 March, 2019 u/Tawaren, a member of the Polkadot community, made a post on
<a href="https://www.reddit.com/r/dot/" target="_blank" rel="noopener noreferrer">r/dot</a> called &quot;SmartProtocols Idea&quot; and laid out a proposal for
<a href="https://www.reddit.com/r/dot/comments/b6kljn/smartprotocols_idea/" target="_blank" rel="noopener noreferrer">Smart Protocols</a>. The core
insight of the post was that XCMP had a complication in that it was difficult to verify and prove
code was executed on a parachain without trust. A solution was to install the SmartProtocols in the
Relay Chain that would be isolated blobs of code with their own storage per instance that could only
be changed through an interface with each parachain. SmartProtocols are the precursor to SPREE.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-a-spree-module">What is a SPREE module?<a href="#what-is-a-spree-module" class="hash-link" aria-label="Direct link to What is a SPREE module?" title="Direct link to What is a SPREE module?">​</a></h2><p>SPREE modules are fragments of logic (in concrete terms they are blobs of
<a href="/docs/learn-wasm">WebAssembly</a> code) that are uploaded onto
Kusama through a governance mechanism or by
parachains. Once the blob is uploaded to
Kusama, all other parachains can decide to
opt-in to the logic. The SPREE module would retain its own storage independent of the parachain, but
would be callable through an interface with the parachain. Parachains will send messages to the
SPREE module synchronously.</p><p>SPREE modules are important to the overall XCMP architecture because they give a guarantee to the
code that will be executed on destination parachains. While XCMP guarantees the delivery of a
message, it does not guarantee what code will be executed, i.e. how the receiving parachain will
interpret the message. While XCMP accomplishes trustless message passing, SPREE is the trustless
interpretation of the message and a key part of the usefulness of XCMP.</p><p>SPREE modules are like recipes in cookbooks. For example, if we give an order to a cook to make a
soufflé, and we’re decently confident in the ability of the cook, we have a vague idea of what will
be made but no actual surety of how it will be made. However, let’s say that a cook has the “Soufflé
Maker’s Manual” on their bookshelf and has committed themselves to only make souffles from this
book. Now we can also consult the same book that the cook has, and we have a precise understanding
of what will happen when we tell the cook to make a soufflé. In this example, “make a soufflé” was
the message in XCMP and the cookbook was the SPREE module.</p><p>In concrete terms, SPREE modules could be useful for various functionality on
Kusama.. One suggested use case of SPREE
modules is for a trustless decentralized exchange that is offered as functionality to any parachain
without any extra effort from parachain developers. One can imagine this working by having a SPREE
module that exposes the interface for the incrementing and decrementing of balances of various
assets based on a unique identifier.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why">Why?<a href="#why" class="hash-link" aria-label="Direct link to Why?" title="Direct link to Why?">​</a></h2><p>Sending messages across parachains in XCMP only ensures that the message will be delivered but does
not specify the code that will be executed, or how the message will be interpreted by the receiving
parachain. There would be ways around this such as requesting a verifiable receipt of the execution
from the receiving parachain, but in the naked case, the other parachain would have to be trusted.
Having shared code that exists in appendices that the parachain can opt-in to resolves the need for
trust and makes the execution of the appendices completely trustless.</p><p>SPREE would be helpful to ensure that the same logic is shared between parachains in the SPREE
modules. An especially relevant use case would revolve around the use of token transfers across
parachains in which it is important that the sending and receiving parachains agree about how to
change the total supply of tokens and a basic interface.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h2><p><img loading="lazy" alt="spree example" src="/assets/images/spree_module-a8eefaaf0abf97f465af31069d8856ff.png" width="345" height="354" class="img_ev3q"></p><p>The diagram above is a simplification of the
Kusama system.</p><p>In this diagram, we see that the Wasm code for SPREE module &quot;X&quot; has been uploaded to the
Kusama Relay Chain. The two cylinders &quot;A&quot;
and &quot;B&quot; represent two distinct parachains that have both opted-in to this SPREE module creating two
distinct instances of it with their own XCMP endpoints &quot;A.X&quot; and &quot;B.X&quot;.</p><p>In the example, we assume that this SPREE module &quot;X&quot; contains the functionality for incrementing or
decrementing the balance of a particular asset that is unique to this module.</p><p>By initiating a transaction at A.X to decrease a particular balance by 1, a message over XCMP can be
trustlessly sent to B.X to increase a balance by 1.</p><p>Collators, represented as the green triangle are responsible for relaying this message from
parachain A to parachain B, as well as maintaining the storage for each particular instance of A.X
and B.X for their respective parachains. They provide proofs of valid state transitions to the Relay
Chain validators represented as blue diamonds.</p><p>Validators can validate the correct state transitions of SPREE modules A.X and B.X by being provided
with the previous state root of the SPREE module instances, the data of the XCMP message between the
instances, and the next state root of the instance. They do this validation by checking it against
the <code>validate</code> function as provided by the SPREE module API. Collators are expected to be able to
provide this information to progress their parachains.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-06-30T14:24:41.000Z">Jun 30, 2023</time></b> by <b>Filippo</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#origin" class="table-of-contents__link toc-highlight">Origin</a></li><li><a href="#what-is-a-spree-module" class="table-of-contents__link toc-highlight">What is a SPREE module?</a></li><li><a href="#why" class="table-of-contents__link toc-highlight">Why?</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li></ul></div></div></div></div></main></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/Kusama_Canary_white.png" alt="Guide" width="66" height="58"></a><div><a href="https://kusama.network/" target="_blank" class="homepage-font">Kusama Network</a><a href="https://polkadot.network/faq/" target="_blank" rel="noreferrer noopener" class="homepage-font">FAQ</a><a href="https://twitter.com/kusamanetwork" target="_blank" rel="noreferrer noopener" class="homepage-font">Twitter</a><a href="https://www.notion.so/web3foundation/Polkadot-Kusama-Community-Hub-ee1fd077ff6c42c381940404f6aa9f1c" target="_blank" rel="noreferrer noopener" class="homepage-font">Community Hub</a><a href="https://kusa.ma/discord" target="_blank" rel="noreferrer noopener" class="homepage-font">Kusama Discord</a><a href="https://matrix.to/#/!HfRYKXBoPmDBCAWUEJ:polkadot.builders" target="_blank" rel="noreferrer noopener" class="homepage-font">Kusama Watercooler</a><a href="https://web3.foundation/grants/" target="_blank" rel="noreferrer noopener" class="homepage-font">Grants and Bounties</a></div><div class="kusama-mainpage-cyber-row"><div class="kusama-mainpage-column"><h2 class="homepage-font-footer">Join a cyber secret society</h2><p class="homepage-font-footer">The Kappa Sigma Mu fraternity asks you to get a Kusama tattoo to join.</p><a href="/docs/maintain-guides-society-kusama"><button class="kusama-mainpage-build-footer">See Kappa Sigma Mu</button></a></div></div></section><section class="row"><div class="copyright homepage-font">© 2023 Web3 Foundation</div>·<a target="_blank" rel="noreferrer noopener" class="item homepage-font" href="https://polkadot.network/legal-disclosures/">Legal Disclosures</a>·<a target="_blank" rel="noreferrer noopener" class="item homepage-font" href="https://polkadot.network/privacy/">Privacy Policy</a></section></footer></div>
<script src="/assets/js/runtime~main.161af186.js"></script>
<script src="/assets/js/main.d3bff339.js"></script>
</body>
</html>