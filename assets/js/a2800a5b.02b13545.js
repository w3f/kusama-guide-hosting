"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3234],{29389:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var a=t(74848),s=t(28453);const i={id:"build-transaction-construction",title:"Transaction Construction and Signing",sidebar_label:"Transaction Construction",description:"Information about how transactions are constructed on Polkadot.",keywords:["transaction","transaction construction","format","tools"],slug:"../build-transaction-construction"},o=void 0,r={id:"build/build-transaction-construction",title:"Transaction Construction and Signing",description:"Information about how transactions are constructed on Polkadot.",source:"@site/../docs/build/build-transaction-construction.md",sourceDirName:"build",slug:"/build-transaction-construction",permalink:"/docs/build-transaction-construction",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"Filippo",lastUpdatedAt:1726730833e3,frontMatter:{id:"build-transaction-construction",title:"Transaction Construction and Signing",sidebar_label:"Transaction Construction",description:"Information about how transactions are constructed on Polkadot.",keywords:["transaction","transaction construction","format","tools"],slug:"../build-transaction-construction"}},c={},d=[{value:"Transaction Format",id:"transaction-format",level:2},{value:"Polkadot-JS Tools",id:"polkadot-js-tools",level:2},{value:"Tx Wrapper",id:"tx-wrapper",level:2},{value:"Submitting a Signed Payload",id:"submitting-a-signed-payload",level:2},{value:"Notes",id:"notes",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["This page will discuss the transaction format in Polkadot and how to create, sign, and broadcast\ntransactions. Like the other pages in this guide, this page demonstrates some of the available\ntools. ",(0,a.jsx)(n.strong,{children:"Always refer to each tool's documentation when integrating."})]}),"\n",(0,a.jsx)(n.h2,{id:"transaction-format",children:"Transaction Format"}),"\n",(0,a.jsx)(n.p,{children:"Polkadot has some basic transaction information that is common to all transactions."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Address: The SS58-encoded address of the sending account."}),"\n",(0,a.jsxs)(n.li,{children:["Block Hash: The hash of the ",(0,a.jsx)(n.a,{href:"/docs/build-protocol-info#transaction-mortality",children:"checkpoint"})," block."]}),"\n",(0,a.jsx)(n.li,{children:"Block Number: The number of the checkpoint block."}),"\n",(0,a.jsx)(n.li,{children:"Genesis Hash: The genesis hash of the chain."}),"\n",(0,a.jsx)(n.li,{children:"Metadata: The SCALE-encoded metadata for the runtime when submitted."}),"\n",(0,a.jsx)(n.li,{children:"Nonce: The nonce for this transaction.*"}),"\n",(0,a.jsx)(n.li,{children:"Spec Version: The current spec version for the runtime."}),"\n",(0,a.jsx)(n.li,{children:"Transaction Version: The current version for transaction format."}),"\n",(0,a.jsxs)(n.li,{children:["Tip: Optional, the ",(0,a.jsx)(n.a,{href:"/docs/build-protocol-info#fees",children:"tip"})," to increase transaction priority."]}),"\n",(0,a.jsx)(n.li,{children:"Mode: The flag indicating whether to verify the metadata hash or not."}),"\n",(0,a.jsxs)(n.li,{children:["Era Period: Optional, the number of blocks after the checkpoint for which a transaction is valid.\nIf zero, the transaction is ",(0,a.jsx)(n.a,{href:"/docs/build-protocol-info#transaction-mortality",children:"immortal"})]}),"\n",(0,a.jsx)(n.li,{children:"MetadataHash: Optional, the metadata hash which should match the RUNTIME_METADATA_HASH environment\nvariable."}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"caution",children:(0,a.jsx)(n.p,{children:"There are risks to making a transaction immortal. If an account is reaped and a user re-funds the\naccount, then they could replay an immortal transaction. Always default to using a mortal extrinsic."})}),"\n",(0,a.jsx)(n.p,{children:"*The nonce queried from the System module does not account for pending transactions. You must track\nand increment the nonce manually if you want to submit multiple valid transactions at the same time."}),"\n",(0,a.jsxs)(n.p,{children:["Each transaction will have its own (or no) parameters to add. For example, the ",(0,a.jsx)(n.code,{children:"transferKeepAlive"}),"\nfunction from the Balances pallet will take:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"dest"}),": Destination address"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"#[compact] value"}),": Number of tokens (compact encoding)"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Refer to ",(0,a.jsx)(n.a,{href:"https://spec.polkadot.network/id-extrinsics",children:"the protocol specifications"}),", for the\nconcrete specifications and types to build a transaction."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Mode and MetadataHash"})}),"\n",(0,a.jsxs)(n.p,{children:["The mode and metadataHash fields were introduced in transaction construction to support the optional\n",(0,a.jsxs)(n.a,{href:"https://github.com/polkadot-fellows/RFCs/blob/main/text/0078-merkleized-metadata.md",children:[(0,a.jsx)(n.code,{children:"CheckMetadataHash"})," Signed Extension"]}),".\nThis enables trustless metadata verification by allowing the chain to verify the correctness of the\nmetadata used without the need of a trusted party. This functionality was included in\n",(0,a.jsx)(n.a,{href:"https://github.com/polkadot-fellows/runtimes/releases/tag/v1.2.5",children:"v1.2.5"})," runtime release by the\nFellowship. A user may up out of this functionality by setting the mode to ",(0,a.jsx)(n.code,{children:"0"}),". When the mode is 00,\nthe ",(0,a.jsx)(n.code,{children:"metadataHash"})," field is empty/None."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Serialized transactions and metadata"})}),"\n",(0,a.jsxs)(n.p,{children:["Before being submitted, transactions are serialized. Serialized transactions are hex encoded\nSCALE-encoded bytes. The relay chain runtimes are upgradable and therefore any interfaces are\nsubject to change, the metadata allows developers to structure any extrinsics or storage entries\naccordingly. The metadata provides you with all of the information required to know how to construct\nthe serialized call data specific to your transaction. You can read more about the metadata, its\nformat and how to get it in the\n",(0,a.jsx)(n.a,{href:"https://docs.substrate.io/reference/command-line-tools/subxt/#metadata",children:"Substrate documentation"}),"."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Summary"})}),"\n",(0,a.jsx)(n.p,{children:"The typical transaction workflow is as follows:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Construct an unsigned transaction."}),"\n",(0,a.jsx)(n.li,{children:"Create a signing payload."}),"\n",(0,a.jsx)(n.li,{children:"Sign the payload."}),"\n",(0,a.jsx)(n.li,{children:"Serialize the signed payload into a transaction."}),"\n",(0,a.jsx)(n.li,{children:"Submit the serialized transaction."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Parity provides the following tools to help perform these steps."}),"\n",(0,a.jsx)(n.h2,{id:"polkadot-js-tools",children:"Polkadot-JS Tools"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/polkadot-js/tools",children:"Polkadot-JS Tools"}),' contains a set of command line tools for\ninteracting with a Substrate client, including one called "Signer CLI" to create, sign, and\nbroadcast transactions.']}),"\n",(0,a.jsxs)(n.p,{children:["This example will use the ",(0,a.jsx)(n.code,{children:"signer submit"})," command, which will create and submit the transaction. The\n",(0,a.jsx)(n.code,{children:"signer sendOffline"})," command has the exact same API, but will not broadcast the transaction.\n",(0,a.jsx)(n.code,{children:"submit"})," and ",(0,a.jsx)(n.code,{children:"sendOffline"})," must be connected to a node to fetch the current metadata and construct a\nvalid transaction. Their API has the format:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"yarn run:signer <submit|sendOffline> --account <from-account-ss58> --ws <endpoint> <module.method> [param1] [...] [paramX]\n"})}),"\n",(0,a.jsx)(n.p,{children:"Signing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"yarn run:signer sign --account <from-account-ss58> --seed <seed> --type <sr25519|ed25519> <payload>\n"})}),"\n",(0,a.jsxs)(n.p,{children:["For example, let's send 0.5 DOT from ",(0,a.jsx)(n.code,{children:"121X5bEgTZcGQx5NZjwuTjqqKoiG8B2wEAvrUFjuw24ZGZf2"})," to\n",(0,a.jsx)(n.code,{children:"15vrtLsCQFG3qRYUcaEeeEih4JwepocNJHkpsrqojqnZPc2y"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"yarn run:signer submit --account 121X5bEgTZcGQx5NZjwuTjqqKoiG8B2wEAvrUFjuw24ZGZf2 --ws ws://127.0.0.1:9944 balances.transferKeepAlive 15vrtLsCQFG3qRYUcaEeeEih4JwepocNJHkpsrqojqnZPc2y 5000000000\n"})}),"\n",(0,a.jsx)(n.p,{children:"This will return a payload to sign and an input waiting for a signature. Take this payload and use\nyour normal signing environment (e.g. air gapped machine, VM, etc.). Sign the payload:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'yarn run:signer sign --account 121X5bEgTZcGQx5NZjwuTjqqKoiG8B2wEAvrUFjuw24ZGZf2 --seed "pulp gaze fuel ... mercy inherit equal" --type sr25519 0x040300ff4a83f1...a8239139ff3ff7c3f6\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Save the output and bring it to the machine that you will broadcast from, enter it into ",(0,a.jsx)(n.code,{children:"submit"}),"'s\nsignature field, and send the transaction (or just return the serialized transaction if using\n",(0,a.jsx)(n.code,{children:"sendOffline"}),")."]}),"\n",(0,a.jsx)(n.h2,{id:"tx-wrapper",children:"Tx Wrapper"}),"\n",(0,a.jsxs)(n.p,{children:["If you do not want to use the CLI for signing operations, Parity provides an SDK called\n",(0,a.jsx)(n.a,{href:"https://github.com/paritytech/txwrapper-core",children:"TxWrapper Core"})," to generate and sign transactions\noffline. For Polkadot, Kusama, and select parachains, use the ",(0,a.jsx)(n.code,{children:"txwrapper-polkadot"})," package. Other\nSubstrate-based chains will have their own ",(0,a.jsx)(n.code,{children:"txwrapper-{chain}"})," implementations. See the\n",(0,a.jsx)(n.a,{href:"https://github.com/paritytech/txwrapper-core/blob/main/packages/txwrapper-examples/README.md",children:"examples"}),"\nfor a guide."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Import a private key"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import { importPrivateKey } from '@substrate/txwrapper-polkadot';\n\nconst keypair = importPrivateKey(\u201cpulp gaze fuel ... mercy inherit equal\u201d);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Derive an address from a public key"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import { deriveAddress } from '@substrate/txwrapper-polkadot';\n\n// Public key, can be either hex string, or Uint8Array\nconst publicKey = \u201c0x2ca17d26ca376087dc30ed52deb74bf0f64aca96fe78b05ec3e720a72adb1235\u201d;\nconst address = deriveAddress(publicKey);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Construct a transaction offline"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { methods } from "@substrate/txwrapper-polkadot";\n\nconst unsigned = methods.balances.transferKeepAlive(\n  {\n    dest: "15vrtLsCQFG3qRYUcaEeeEih4JwepocNJHkpsrqojqnZPc2y",\n    value: 5000000000,\n  },\n  {\n    address: "121X5bEgTZcGQx5NZjwuTjqqKoiG8B2wEAvrUFjuw24ZGZf2",\n    blockHash: "0x1fc7493f3c1e9ac758a183839906475f8363aafb1b1d3e910fe16fab4ae1b582",\n    blockNumber: 4302222,\n    genesisHash: "0xe3777fa922cafbff200cadeaea1a76bd7898ad5b89f7848999058b50e715f636",\n    metadataRpc, // must import from client RPC call state_getMetadata\n    nonce: 2,\n    specVersion: 1019,\n    tip: 0,\n    eraPeriod: 64, // number of blocks from checkpoint that transaction is valid\n    transactionVersion: 1,\n  },\n  {\n    metadataRpc,\n    registry, // Type registry\n  }\n);\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Construct a signing payload"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { methods, createSigningPayload } from \'@substrate/txwrapper-polkadot\';\n\n// See "Construct a transaction offline" for "{...}"\nconst unsigned = methods.balances.transferKeepAlive({...}, {...}, {...});\nconst signingPayload = createSigningPayload(unsigned, { registry });\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Serialize a signed transaction"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { createSignedTx } from "@substrate/txwrapper-polkadot";\n\n// Example code, replace `signWithAlice` with actual remote signer.\n// An example is given here:\n// https://github.com/paritytech/txwrapper-core/blob/b213cabf50f18f0fe710817072a81596e1a53cae/packages/txwrapper-core/src/test-helpers/signWithAlice.ts\nconst signature = await signWithAlice(signingPayload);\nconst signedTx = createSignedTx(unsigned, signature, { metadataRpc, registry });\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Decode payload types"})}),"\n",(0,a.jsx)(n.p,{children:"You may want to decode payloads to verify their contents prior to submission."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { decode } from "@substrate/txwrapper-polkadot";\n\n// Decode an unsigned tx\nconst txInfo = decode(unsigned, { metadataRpc, registry });\n\n// Decode a signing payload\nconst txInfo = decode(signingPayload, { metadataRpc, registry });\n\n// Decode a signed tx\nconst txInfo = decode(signedTx, { metadataRpc, registry });\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Check a transaction's hash"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import { getTxHash } from \u2018@substrate/txwrapper-polkadot\u2019;\nconst txHash = getTxHash(signedTx);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"submitting-a-signed-payload",children:"Submitting a Signed Payload"}),"\n",(0,a.jsx)(n.p,{children:"There are several ways to submit a signed payload:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Signer CLI (",(0,a.jsx)(n.code,{children:"yarn run:signer submit --tx <signed-transaction> --ws <endpoint>"}),")"]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/docs/build-node-interaction#substrate-api-sidecar",children:"Substrate API Sidecar"})}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/build-node-interaction#polkadot-rpc",children:"RPC"})," with ",(0,a.jsx)(n.code,{children:"author_submitExtrinsic"})," or\n",(0,a.jsx)(n.code,{children:"author_submitAndWatchExtrinsic"}),", the latter of which will subscribe you to events to be notified\nas a transaction gets validated and included in the chain."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,a.jsxs)(n.p,{children:["Some addresses to use in the examples. See\n",(0,a.jsx)(n.a,{href:"https://docs.substrate.io/reference/command-line-tools/subkey/",children:"Subkey documentation"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"$ subkey --network polkadot generate\nSecret phrase `pulp gaze fuel ... mercy inherit equal` is account:\n  Secret seed:      0x57450b3e09ba4598 ... ... ... ... ... ... ... .. 219756eeba80bb16\n  Public key (hex): 0x2ca17d26ca376087dc30ed52deb74bf0f64aca96fe78b05ec3e720a72adb1235\n  Account ID:       0x2ca17d26ca376087dc30ed52deb74bf0f64aca96fe78b05ec3e720a72adb1235\n  SS58 Address:     121X5bEgTZcGQx5NZjwuTjqqKoiG8B2wEAvrUFjuw24ZGZf2\n\n$ subkey --network polkadot generate\nSecret phrase `exercise auction soft ... obey control easily` is account:\n  Secret seed:      0x5f4bbb9fbb69261a ... ... ... ... ... ... ... .. 4691ed7d1130fbbd\n  Public key (hex): 0xda04de6cd781c98acf0693dfb97c11011938ad22fcc476ed0089ac5aec3fe243\n  Account ID:       0xda04de6cd781c98acf0693dfb97c11011938ad22fcc476ed0089ac5aec3fe243\n  SS58 Address:     15vrtLsCQFG3qRYUcaEeeEih4JwepocNJHkpsrqojqnZPc2y\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var a=t(96540);const s={},i=a.createContext(s);function o(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);