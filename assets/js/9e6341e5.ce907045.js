"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1774],{3905:(e,t,s)=>{s.d(t,{Zo:()=>c,kt:()=>v});var n=s(67294);function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function i(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){r(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function o(e,t){if(null==e)return{};var s,n,r=function(e,t){if(null==e)return{};var s,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)s=a[n],t.indexOf(s)>=0||(r[s]=e[s]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)s=a[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}var l=n.createContext({}),d=function(e){var t=n.useContext(l),s=t;return e&&(s="function"==typeof e?e(t):i(i({},t),e)),s},c=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var s=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),h=d(s),p=r,v=h["".concat(l,".").concat(p)]||h[p]||u[p]||a;return s?n.createElement(v,i(i({ref:t},c),{},{components:s})):n.createElement(v,i({ref:t},c))}));function v(e,t){var s=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=s.length,i=new Array(a);i[0]=p;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[h]="string"==typeof e?e:r,i[1]=o;for(var d=2;d<a;d++)i[d]=s[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,s)}p.displayName="MDXCreateElement"},61601:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>v,frontMatter:()=>o,metadata:()=>d,toc:()=>h});var n=s(87462),r=s(63366),a=(s(67294),s(3905)),i=["components"],o={id:"learn-xcm-docs-transfers-reserve",title:"Reserve-backed Transfers",sidebar_label:"Reserve-backed Transfers",description:"Reserve-backed Transfers: Third-party Reserve to store Assets.",keywords:["xcm","cross-consensus messaging","transfers","reserve"],slug:"../transfers-reserve"},l="Reserve-backed transfers",d={unversionedId:"learn/xcm/journey/transfers/learn-xcm-docs-transfers-reserve",id:"learn/xcm/journey/transfers/learn-xcm-docs-transfers-reserve",title:"Reserve-backed Transfers",description:"Reserve-backed Transfers: Third-party Reserve to store Assets.",source:"@site/../docs/learn/xcm/journey/transfers/reserve.md",sourceDirName:"learn/xcm/journey/transfers",slug:"/learn/xcm/journey/transfers-reserve",permalink:"/docs/learn/xcm/journey/transfers-reserve",draft:!1,tags:[],version:"current",lastUpdatedBy:"bader y",lastUpdatedAt:1694099593,formattedLastUpdatedAt:"Sep 7, 2023",frontMatter:{id:"learn-xcm-docs-transfers-reserve",title:"Reserve-backed Transfers",sidebar_label:"Reserve-backed Transfers",description:"Reserve-backed Transfers: Third-party Reserve to store Assets.",keywords:["xcm","cross-consensus messaging","transfers","reserve"],slug:"../transfers-reserve"}},c={},h=[{value:"Process",id:"process",level:2},{value:"1. InitiateReserveWithdraw",id:"1-initiatereservewithdraw",level:3},{value:"2. WithdrawAsset",id:"2-withdrawasset",level:3},{value:"3. DepositReserveAsset",id:"3-depositreserveasset",level:3},{value:"4. ReserveAssetDeposited",id:"4-reserveassetdeposited",level:3},{value:"5. DepositAsset",id:"5-depositasset",level:3},{value:"Thoughts",id:"thoughts",level:3},{value:"A note on trust",id:"a-note-on-trust",level:3},{value:"Example",id:"example",level:2},{value:"InitiateReserveWithdraw",id:"initiatereservewithdraw",level:3},{value:"DepositReserveAsset",id:"depositreserveasset",level:3},{value:"ReserveAssetDeposited",id:"reserveassetdeposited",level:3},{value:"Another example",id:"another-example",level:2},{value:"Another note on trust",id:"another-note-on-trust",level:3},{value:"Next steps",id:"next-steps",level:2}],u={toc:h},p="wrapper";function v(e){var t=e.components,o=(0,r.Z)(e,i);return(0,a.kt)(p,(0,n.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"reserve-backed-transfers"},"Reserve-backed transfers"),(0,a.kt)("p",null,"For consensus systems that don't have the level of trust required for asset teleportation, they can\ninstead opt for trusting a third party called a reserve to store the real assets (think Statemine on\nKusama, or Statemint on Polkadot). The source and the destination need a way to keep track of the\nreal assets they own on the reserve, this is usually done by minting a new derivative token. Both\nsource and destination now need accounts on the reserve to hold their assets, we call these their\nsovereign accounts on that system."),(0,a.kt)("h2",{id:"process"},"Process"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Reserve Backed Transfer diagram",src:s(94079).Z,width:"863",height:"651"})),(0,a.kt)("p",null,"The flow in this diagram is further explained below:"),(0,a.kt)("h3",{id:"1-initiatereservewithdraw"},"1. InitiateReserveWithdraw"),(0,a.kt)("p",null,"The source gathers the derivative assets to be transferred from the sending account and burns them,\ntaking note of the amount of derivatives that were burned."),(0,a.kt)("h3",{id:"2-withdrawasset"},"2. WithdrawAsset"),(0,a.kt)("p",null,"The source sends a ",(0,a.kt)("inlineCode",{parentName:"p"},"WithdrawAsset")," instruction to the reserve, instructing it to withdraw real\nassets equivalent to the amount of derivatives burned from the source chain."),(0,a.kt)("h3",{id:"3-depositreserveasset"},"3. DepositReserveAsset"),(0,a.kt)("p",null,"The reserve deposits the assets withdrawn from the previous step to the destination's sovereign\naccount, taking note of the amount of assets deposited."),(0,a.kt)("h3",{id:"4-reserveassetdeposited"},"4. ReserveAssetDeposited"),(0,a.kt)("p",null,"The reserve creates a ",(0,a.kt)("inlineCode",{parentName:"p"},"ReserveAssetDeposited")," instruction with the amount of assets deposited to the\ndestination's sovereign account, and sends this instruction onwards to the destination. The\ndestination receives the instruction and processes it, minting the correct amount of derivative\nassets."),(0,a.kt)("h3",{id:"5-depositasset"},"5. DepositAsset"),(0,a.kt)("p",null,"The destination deposits the derivative assets minted to the receiving account."),(0,a.kt)("h3",{id:"thoughts"},"Thoughts"),(0,a.kt)("p",null,"The addition of a third consensus system is already a hint of the disadvantages of a reserve asset\ntransfer model. Firstly, the reserve could easily become a point of centralization when too many\nconsensus systems rely on it to be the reserve of choice for their assets. Secondly, the sheer\namount of steps required necessarily makes it more prone to errors, and as such, implementors will\nhave to consider more possible pitfalls and provide technical support accordingly when an end user\nencounters issues arising from these steps. Last, but not least, either the source or destination\ncan opt to designate multiple consensus systems to be their reserves. In such a situation, care must\nbe taken in order to ensure that the sovereign accounts on the reserves are balanced, so that one\ndoesn't get drained while the others still contain a healthy balance."),(0,a.kt)("h3",{id:"a-note-on-trust"},"A note on trust"),(0,a.kt)("p",null,"We mentioned that reserve-backed transfers require the sender and the destination to trust a third\nparty, the reserve, and not each other. This is true, but it doesn't mean the sender and destination\nhave to trust ONLY the reserve, they also have to trust the issuer of the token. Whenever you are\ndealing with a particular asset, you are always trusting the issuer of said asset, because at any\npoint they could mint a huge amount of that asset, wreaking havoc. You have to make sure you trust\nthe asset, based on the security mechanisms used to protect its issuance. For this reason, reserves\nwork best when they are the issuers of the asset being transacted. In that scenario, you only have\nto trust the reserve, period."),(0,a.kt)("h2",{id:"example"},"Example"),(0,a.kt)("p",null,"We'll create a program for the scenario in the diagram. Let's assume that the reserve is a relay\nchain and both source and destination are parachains 1 and 2 respectively. Let's also say that an\naccount ALICE in parachain 1 wants to transfer the relay chain's native token to their other account\n(also ALICE) on parachain 2. The program might look like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"let message = Xcm(vec![\n  WithdrawAsset((Parent, amount).into()),\n  InitiateReserveWithdraw {\n    assets: All.into(),\n    reserve: Parent.into(),\n    xcm: Xcm(vec![DepositReserveAsset {\n      assets: All.into(),\n      dest: Parachain(2).into(),\n      xcm: Xcm(vec![DepositAsset {\n        assets: All.into(),\n        beneficiary: AccountId32 { id: ALICE.into(), network: None }.into(),\n      }]),\n    }]),\n  },\n]);\n")),(0,a.kt)("p",null,"This program should be executed on the source, so on parachain 1. We start, as usual, with a\n",(0,a.kt)("inlineCode",{parentName:"p"},"WithdrawAsset")," instruction. The ",(0,a.kt)("inlineCode",{parentName:"p"},"MultiAsset")," here references the relay chain's native token, which\nmeans we'll be gathering the derivative on this chain."),(0,a.kt)("h3",{id:"initiatereservewithdraw"},"InitiateReserveWithdraw"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"InitiateReserveWithdraw { assets: MultiAssetFilter, reserve: MultiLocation, xcm: Xcm<()> }\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"InitiateReserveWithdraw")," instruction takes the derivative token from the holding register and\nburns it. Then it sends a new XCM to the specified ",(0,a.kt)("inlineCode",{parentName:"p"},"reserve"),", in this example, the relay chain. This\nnew XCM contains the following instructions, in order:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"WithdrawAsset"),(0,a.kt)("li",{parentName:"ol"},"ClearOrigin"),(0,a.kt)("li",{parentName:"ol"},"All instructions specified in the ",(0,a.kt)("inlineCode",{parentName:"li"},"xcm")," operand, in this case ",(0,a.kt)("inlineCode",{parentName:"li"},"DepositReserveAsset"))),(0,a.kt)("p",null,"As was the case with ",(0,a.kt)("a",{parentName:"p",href:"/docs/learn/xcm/journey/transfers-teleport"},"teleports"),", instructions 1. and 2. are added automatically by\nthe executor when using ",(0,a.kt)("inlineCode",{parentName:"p"},"InitiateReserveWithdraw"),"."),(0,a.kt)("p",null,"Upon receiving this XCM, the reserve will withdraw the asset from parachain 1's sovereign account\n(where the real asset is stored), and deposit it on parachain 2's sovereign account."),(0,a.kt)("h3",{id:"depositreserveasset"},"DepositReserveAsset"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"DepositReserveAsset { assets: MultiAssetFilter, dest: MultiLocation, xcm: Xcm<()> }\n")),(0,a.kt)("p",null,"This instruction is used in this example instead of ",(0,a.kt)("inlineCode",{parentName:"p"},"DepositAsset"),", because as well as depositing\nthe assets to parachain 2's sovereign account, this instruction will send another XCM to\nparachain 2. This new XCM has the following instructions:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"ReserveAssetDeposited"),(0,a.kt)("li",{parentName:"ol"},"ClearOrigin"),(0,a.kt)("li",{parentName:"ol"},"All instructions specified in the ",(0,a.kt)("inlineCode",{parentName:"li"},"xcm")," operand, in this case, only ",(0,a.kt)("inlineCode",{parentName:"li"},"DepositAsset"))),(0,a.kt)("h3",{id:"reserveassetdeposited"},"ReserveAssetDeposited"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"ReserveAssetDeposited(MultiAssets)\n")),(0,a.kt)("p",null,"Parachain 2 receives the XCM, mints new derivative tokens and deposit them locally to the\nbeneficiary account. ",(0,a.kt)("inlineCode",{parentName:"p"},"ReserveAssetDeposited")," is a ",(0,a.kt)("em",{parentName:"p"},"trusted indication"),". As is the case with\nteleporting, you need to trust the reserve to have actually put the specified amount of assets in\nthe sovereign account of this system. You can specify which systems you trust as reserves for which\nassets by configuring the ",(0,a.kt)("a",{parentName:"p",href:"/docs/learn/xcm/config-deep-dive"},"IsReserve")," type in the executor. In our\nexample, both parachains trust the relay chain as a reserve for its own native token."),(0,a.kt)("h2",{id:"another-example"},"Another example"),(0,a.kt)("p",null,"We now know this type of transfers requires 3 actors: the source, the reserve, and the destination.\nHowever, the source and reserve don't have to be different systems, they could be one and the same,\nas in the following diagram."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Source is reserve",src:s(98689).Z,width:"805",height:"271"})),(0,a.kt)("p",null,"In this case the message is the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"let message = Xcm(vec![\n  WithdrawAsset((Parent, amount).into()),\n  DepositReserveAsset {\n    assets: All.into(),\n    dest: Parachain(2).into(),\n    xcm: Xcm(vec![DepositAsset {\n      assets: All.into(),\n      beneficiary: AccountId32 { id: ALICE.into(), network: None }.into(),\n    }]),\n  },\n]);\n")),(0,a.kt)("p",null,"This simplifies the reserve-backed transfer. However, the destination still needs to:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Recognize the source as the proper reserve for the tokens that are being sent over and"),(0,a.kt)("li",{parentName:"ul"},"Support minting derivatives of the tokens being sent over")),(0,a.kt)("p",null,"It's also possible to skip the ",(0,a.kt)("inlineCode",{parentName:"p"},"WithdrawAsset")," instruction. The ",(0,a.kt)("inlineCode",{parentName:"p"},"TransferReserveAsset")," instruction\nhandles the withdrawal already. It can be called like so:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rust"},"let message = Xcm(vec![\n  TransferReserveAsset {\n    assets: (Parent, amount).into(),\n    dest: Parachain(2).into(),\n    xcm: Xcm(vec![DepositAsset {\n      assets: All.into(),\n      beneficiary: AccountId32 { id: ALICE.into(), network: None }.into(),\n    }]),\n  },\n]);\n")),(0,a.kt)("h3",{id:"another-note-on-trust"},"Another note on trust"),(0,a.kt)("p",null,"In this model, where the sender is the reserve, the destination is trusting the sender entirely.\nIt's the sender the one who doesn't need to trust the destination, since it'll ever only be minting\nderivatives anyway, the sender/reserve controls the real assets and issuance."),(0,a.kt)("h2",{id:"next-steps"},"Next steps"),(0,a.kt)("p",null,"Next, we'll talk about a very important topic we mentioned before but skipped in this chapter,\n",(0,a.kt)("a",{parentName:"p",href:"../fees/index.html"},"paying fees")," for the effects our XCMs have."))}v.isMDXComponent=!0},94079:(e,t,s)=>{s.d(t,{Z:()=>n});const n=s.p+"assets/images/reserve_asset_transfer-14d4ab3d815e04d0a6286921abe6007c.png"},98689:(e,t,s)=>{s.d(t,{Z:()=>n});const n=s.p+"assets/images/source_is_reserve-78e1a6fa98531fdfa5bcdf518c116a1b.png"}}]);